 /* jshint maxlen: 300 */
 const TelegramBot = require('node-telegram-bot-api');
 const fs = require('fs');
 const {
   weather,
   randomize,
   isWorkingTime,
   isdbName,
   url,
   token,
   basicauth,
   InlineKB,
   ButtonStartMenu,
   GetNameDB,
   GetPackResultsCount,
   GetPackResults,
   GetCurDay,
   GetPeriodBack
   
 } = require('./testexport');
 const {
   Console
 } = require('console');
 const bot = new TelegramBot(token, {
   polling: true
 });
 let databurn, phone, list, ordertime, namer, homeadress, orderphone, ordernumclient, trimmedStr;
 let today = new Date();
 let modifydate = new Date();
 let curyear = today.getFullYear();
 let outputdate, countcode = 0;
 let actualid, textid,analcount ;
 let DateRegularexp = /^(\d{2})\/(\d{2})\/(\d{4})$/;
 let DateRegularexp1 = /^(?!(\d{2}\/\d{2}\/\d{4}|\d{4}-\d{2}-\d{2})$).*$/
 ;

 let TelegramId ;
 let SelectTriger = false;
 let BurnTriger = false;
 let PhoneTriger = false;
 let QuestionPhoneTriger = false;
 let intervalId = 0;
 let ArrayCheckAnalyze = [];
 let timepause = 10000; // 900000;
 let ii = true;
 const intervals = {};
 const userphones = {};
 const userburns = {};
 let isAlreadySent = false;
  let getWorkperiodstatus;
 const  demosmspng = '.\\demosms.png';
let GetTrigerObject = {};
let arrayyearcount = [];

 console.log('–¢–µ–ª–µ–≥—Ä–∞–º –±–æ—Ç MTS Clinic - –∑–∞–ø—É—â–µ–Ω–æ');




 
 function StartMonitor(query){ 
  GetNameDB(Number(query))
      .then(telegram => {
    outputdate = telegram._doc.BirthDay;
    bot.sendMessage(query, `–í—ñ—Ç–∞—é –í–∞—Å, ${telegram.FullName}\n–í–∞—à –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω—É: 0${telegram._doc.Phone}\n–í–∞—à–∞ –¥–∞—Ç–∞ –Ω–∞—Ä–æ–¥–∂–µ–Ω–Ω—è: ${telegram._doc.BirthDay} `)
      .then(bot.sendMessage(query, '–ó–∞–ø—É—Å–∫–∞—é —Å–∏—Å—Ç–µ–º—É –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥—É –∞–∫—Ç—É–∞–ª—å–Ω–∏—Ö –∑–∞–º–æ–≤–ª–µ–Ω—å –≤ –ª–∞–±–æ—Ä–∞—Ç–æ—Ä—ñ—ó. –°–∫–∞–Ω—É–≤–∞–Ω–Ω—è –∑–º—ñ–Ω —Å—Ç–∞—Ç—É—Å—É –≤–∏–∫–æ–Ω–∞–Ω–Ω—è —ñ—Å–Ω—É—é—á–∏—Ö –¥–æ—Å–ª—ñ–¥–∂–µ–Ω—å –ø—Ä–æ—Ö–æ–¥–∏—Ç—å —â–æ 15 —Ö–≤.', {
          reply_markup: {
            keyboard: [
              [{
                text: '–ó—É–ø–∏–Ω–∏—Ç–∏ –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥',
                request_contact: false,



              }, ]
            ],
            resize_keyboard: false

          }
        })
        .then(data => {

          if ((query in intervals) == false) {


            intervalId = setInterval(() => {


              const currentTime = new Date();
             
              // –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è –±–∞–∂–∞–Ω–æ–≥–æ —á–∞—Å—É
              const desiredTime = new Date();
              desiredTime.setHours(23);
              desiredTime.setMinutes(50);

              // –ü–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è –≥–æ–¥–∏–Ω
              if (currentTime <= desiredTime) {
                console.log('–ß–∞—Å –º–µ–Ω—à–∏–π –∞–±–æ –¥–æ—Ä—ñ–≤–Ω—é—î 23:50');
                GetPackResults(telegram._doc.BirthDay, telegram._doc.Phone, GetPeriodBack(1000), GetCurDay())
                  .then(response => {

                    if (response.ok) {
                      response.json()
                        .then(data => {
                          console.log(data);

                          if (data.length == 0) {
                            bot.sendMessage(query, '–£ –í–∞—Å –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ –∞–Ω–∞–ª—ñ–∑—ñ–≤ –¥–æ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –≤ –ø–æ—Ç–æ—á–Ω–æ–º—É –ø–µ—Ä—ñ–æ–¥—ñ.');
                            stopInterval(query);
                          }
                          for (let i = 0; i < data.length; i++) {
                            const resarray = data[i];
                            isAlreadySent = false;
                            for (let j = 0; j < ArrayCheckAnalyze.length; j++) {
                              if (resarray.Docstatus == '—Å–∫–∞—Å–æ–≤–∞–Ω–æ') {
                                continue;
                              }
                              const item = ArrayCheckAnalyze[j];
                              if (resarray.WebCode == item) {
                                console.log(`–¶—ñ –¥–∞–Ω—ñ —è –≤–∂–µ –ø–µ—Ä–µ–¥–∞–≤: ${resarray.WebCode}`);
                                isAlreadySent = true;
                                //break;
                              }
                            }
                            if (!isAlreadySent) {
                              if (resarray.Docstatus == '–ø–µ—Ä–µ–≤—ñ—Ä–µ–Ω–æ') {
                                if (ArrayCheckAnalyze.length >= 0) {
                                  bot.sendMessage(query, `–ó–Ω–∞–π–¥–µ–Ω–æ –¥–æ—Å–ª—ñ–¥–∂–µ–Ω–Ω—è –≤ —Å—Ç–∞—Ç—É—Å—ñ: ${resarray.Docstatus}. –ù–∞–¥—Å–∏–ª–∞—é –π–æ–≥–æ –í–∞–º`)
                                    .then(ArrayCheckAnalyze.push(resarray.WebCode));
                                }


                                GetPdfCode(query, resarray.WebCode, data.length);
                              } else {
                                if (ii == true) {




                                  setTimeout(() => {
                                    if (resarray.Docstatus != '—Å–∫–∞—Å–æ–≤–∞–Ω–æ') {
                                      bot.sendMessage(query, `–¢–∞–∫–æ–∂ –∑–Ω–∞–π–¥–µ–Ω–æ  –¥–æ—Å–ª—ñ–¥–∂–µ–Ω–Ω—è –≤ —Å—Ç–∞—Ç—É—Å—ñ: ${resarray.Docstatus}. –û—á—ñ–∫—É–π—Ç–µ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è`, {
                                        reply_markup: {
                                          remove_keyboard: false
                                        }
                                      });
                                    }
                                  }, 6000);
                                  ii = false;




                                }
                              }

                            }
                          }






                        });
                    }
                  });

              } else {
                stopInterval(query.message.chat.id);
                console.log('–ß–∞—Å –±—ñ–ª—å—à–∏–π –∑–∞ 23:59');
                bot.sendMessage(query, '–ó—É–ø–∏–Ω–∫–∞ –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥—É –ø–æ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—é –∫–∞–ª–µ–Ω–¥–∞—Ä–Ω–æ—ó –¥–æ–±–∏. –î–ª—è –ø—Ä–æ–¥–æ–≤–∂–µ–Ω–Ω—è –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥—É –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç—ñ—Ç—å –ø–æ—Å–ª—É–≥—É –≤ –Ω–æ–≤—ñ–π –∫–∞–ª–µ–Ω–¥–∞—Ä–Ω—ñ–π –¥–æ–±—ñ.');
              }


              // telegram._doc.BirthDay,telegram._doc.Phone,'01-01-2023','12-21.2023'
            }, timepause);
            intervals[query] = intervalId;



          } else {
            bot.sendMessage(query, `‚ö†	–ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ –≤–∂–µ –∑–∞–ø—É—â–µ–Ω–æ.	`);
          }
        })







      );

  })
  .catch(err => {
    bot.sendMessage(query, '–£ –º–µ–Ω–µ –≤—ñ–¥—Å—É—Ç–Ω—ñ –¥–∞–Ω—ñ –ø—Ä–æ –í–∞—Å. –î–ª—è –∑–∞–ø—É—Å–∫—É –≤—ñ–¥—Å—Ç–µ–∂–µ–Ω–Ω—è –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—ñ –≤–∏–∫–æ–Ω–∞–Ω–Ω–Ω—è –¥–æ—Å–ª—ñ–¥–∂–µ–Ω–Ω—å, –ø–æ—Ç—Ä—ñ–±–Ω–æ –æ—Ç—Ä–∏–º–∞—Ç–∏ –≤—ñ–¥ –í–∞—Å, –¥–∞—Ç—É –Ω–∞—Ä–æ–¥–∂–µ–Ω–Ω—è —ñ –í–∞—à –Ω–æ–º–µ—Ä –º–æ–±—ñ–ª—å–Ω–æ–≥–æ —Ç–µ–ª–µ—Ñ–æ–Ω—É, —è–∫–∏–π –í–∏ —Ä–µ—î—Å—Ç—Ä—É–≤–∞–ª–∏ –≤ –ª–∞–±–æ—Ä–∞—Ç–æ—Ä—ñ—ó', GetKeybNull);



  });
}



 bot.onText(DateRegularexp, (msg) => {
  if (validateDate(msg.text)==true){
    userburns[msg.chat.id] = modifydate.DateMod(msg.text);
 
  
  
  

  


   
  if (userphones[msg.chat.id] == undefined && validateDateObj(userburns[msg.chat.id])) {
     bot.sendMessage(msg.chat.id, `–î—è–∫—É—î–º–æ! –í–∞—à–∞ –¥–∞—Ç–∞ –Ω–∞—Ä–æ–¥–∂–µ–Ω–Ω—è: ${userburns[msg.chat.id]}`, GetKeyboardonlyBurn(userburns[msg.chat.id]));
   } else if (validateDateObj(userburns[msg.chat.id]) && userphones[msg.chat.id]){
     bot.sendMessage(msg.chat.id, `–î—è–∫—É—î–º–æ! –í–∞—à–∞ –¥–∞—Ç–∞ –Ω–∞—Ä–æ–¥–∂–µ–Ω–Ω—è: ${userburns[msg.chat.id]}`, GetKeyboradBurnandPhone(userphones[msg.chat.id], userburns[msg.chat.id]));
     isdbName(msg.chat.id, Number(userphones[msg.chat.id]), userburns[msg.chat.id], GetPeriodBack(1000), GetCurDay());

   } else{ (bot.sendMessage(msg.chat.id,'–í—ñ–¥—Å—É—Ç–Ω—è —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø—Ä–æ –í–∞—Å.'));}



   if (GetTrigerObject[msg.chat.id].BurnTriger == true && userphones[msg.chat.id] == undefined) {
     bot.sendMessage(msg.chat.id, `–¢–µ–ø–µ—Ä –ø–æ–ø—Ä–æ—à—É –í–∞—Å –Ω–∞–¥–∞—Ç–∏ –¥–æ–∑–≤—ñ–ª –Ω–∞ –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –í–∞—à–æ–≥–æ –º–æ–±—ñ–ª—å–Ω–æ–≥–æ –Ω–æ–º–µ—Ä–∞. –ù–∞—Ç–∏—Å–Ω—ñ—Ç—å –∫–Ω–æ–ø–∫—É , —â–æ –∑'—è–≤–∏–ª–∞—Å—è –ø—ñ–¥ –ø–æ–ª–µ–º –≤–≤–æ–¥—É.`, {
       reply_markup: {
         keyboard: [
           [{
             text: '–ù–∞–¥—ñ—Å–ª–∞—Ç–∏ –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω—É',
             request_contact: true,




             // –í–º–∏–∫–∞—î–º–æ –∑–∞–ø–∏—Ç –Ω–∞ –Ω–∞–¥—Å–∏–ª–∞–Ω–Ω—è –∫–æ–Ω—Ç–∞–∫—Ç—É
           }]


         ],

         resize_keyboard: false

         // –í–º–∏–∫–∞—î–º–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –∑–º–µ–Ω—à–µ–Ω–Ω—è –∫–ª–∞–≤—ñ–∞—Ç—É—Ä–∏
       }
     });
   }

 
 if (GetTrigerObject[msg.chat.id].SelectTriger == true && userphones[msg.chat.id] && userburns[msg.chat.id] && GetTrigerObject[msg.chat.id].PhoneTriger == false){bot.sendMessage(msg.chat.id,'–û–±–µ—Ä—ñ—Ç—å –ø–æ—Ç—Ä—ñ–±–Ω–∏–π –ø–µ—Ä—ñ–æ–¥',YearSelect);
  } else {}
 if (GetTrigerObject[msg.chat.id].StartScan == true && validateDateObj(userburns[msg.chat.id])){
  
 isdbName(msg.chat.id, Number(userphones[msg.chat.id]), userburns[msg.chat.id], GetPeriodBack(1000), GetCurDay())
 .then(

  setTimeout(()=>{StartMonitor(msg.chat.id);   },2000)
    
 
 
 
 
 )
.catch(err =>{bot.sendMessage(msg.chat.id,'–ü–æ–º–∏–ª–∫–∞. –í—ñ–¥—Å—É—Ç–Ω—è —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø—Ä–æ –í–∞—Å –≤ –±–∞–∑—ñ –¥–∞–Ω–Ω–∏—Ö MTS Clinic',GetKeyboardonlyBurn(userburns[msg.chat.id]));})
     

 
 
 } else {}
 




 } else { console.log('–ü–æ–º–∏–ª–∫–∞ –¥–∞—Ç–∞ –Ω—É–ª—ñ');
   
  }


 });
 async function requestdataCount(msg, newac, newaca = newac, phoneq, outputdateq) {
  try {
    const response = await fetch(`${url}/custom/GetPatientExams?BurnDate=${outputdateq}&PhoneNumber=${phoneq}&BegDate=${newaca}-01-01&EndDate=${newac}-12-31`, {
      headers: {
        'Authorization': basicauth
      }
    });

    if (response.ok) {
      const data = await response.json();
      const nameArray = data.length;
      return nameArray;
    } else {
      throw new Error('Request failed');
    }
  } catch (error) {
    throw error;
  }
}

  
 
 async function requestdata(msg, newac, newaca,phoneq,outputdateq) {

    

   bot.sendMessage(msg, `–ü–æ—á–∏–Ω–∞—é –ø–æ—à—É–∫ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó. –†–µ–∑—É–ª—å—Ç–∞—Ç –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –∑–∞–ø–∏—Ç—É - —Ü–µ –æ–∫—Ä–µ–º—ñ —Ñ–∞–π–ª–∏ pdf —Ñ–æ—Ä–º–∞—Ç—É. –ß–∞—Å –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –º–æ–∂–µ –±—É—Ç–∏ –∑–Ω–∞—á–Ω–∏–º. –ó–∞—á–µ–∫–∞–π—Ç–µ –ø–æ–≤–Ω–æ–≥–æ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –∑–∞–ø–∏—Ç—É.`)

    if (phoneq == undefined || outputdateq == undefined || validateDateObj(outputdateq)==false) {bot.sendMessage(msg,'–í–∏–Ω–∏–∫–ª–∞ –ø–æ–º–∏–ª–∫–∞. –í—ñ–¥—Å—É—Ç–Ω—ñ –∞–±–æ –Ω–µ–∫–æ—Ä–µ–∫—Ç–Ω—ñ –¥–∞–Ω—ñ. –ü—Ä–æ–π–¥—ñ—Ç—å –ø—Ä–æ—Ü–µ–¥—É—Ä—É –∑ –≥–æ–ª–æ–≤–Ω–æ–≥–æ –º–µ–Ω—é - –∑–∞–Ω–æ–≤–æ');} else {

   await fetch(`${url}/custom/GetPatientExams?BurnDate=${outputdateq}&PhoneNumber=${phoneq}&BegDate=${newaca}-01-01&EndDate=${newac}-12-31`, {
       headers: {
         // 'Authorization': 'Basic TWVkVGVjaHxNZWRUZWNoV2ViOk1lZFRlY2gxMjMh'
         'Authorization': basicauth
       }
     })
     .catch(error => {
       bot.sendMessage(msg, `–í–∏–Ω–∏–∫–ª–∞ –ø–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö. –°–ø—Ä–æ–±—É–π—Ç–µ –ø—ñ–∑–Ω—ñ—à–µ.`);
     })
     .then(response => {
       //response.ok
       if (response.ok) {
         response.json()
           .then(data => {

             const nameArray = data.length;

             if (nameArray == 0) {
               bot.sendMessage(msg, `–†–µ–∑—É–ª—å—Ç–∞—Ç –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –∑–∞–ø–∏—Ç—É - –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ –∑–∞–º–æ–≤–ª–µ–Ω—å –ø–æ –í–∞—à–∏–º –¥–∞–Ω–∏–º. –í—ñ–¥—Å—É—Ç–Ω—ñ –¥–∞–Ω—ñ –≤ –ª–∞–±–æ—Ä–∞—Ç–æ—Ä—ñ—ó –ø–æ –í–∞—à–∏–º –Ω–∞–¥–∞–Ω–∏–º –¥–∞–Ω–∏–º.`);
             } else {
               const status = data[0].Docstatus;
               // if (status == '–ø–µ—Ä–µ–≤—ñ—Ä–µ–Ω–æ'){
               bot.sendMessage(msg, `–†–µ–∑—É–ª—å—Ç–∞—Ç –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –∑–∞–ø–∏—Ç—É - –∑–Ω–∞–π–¥–µ–Ω–æ ${nameArray} –∑–∞–º–æ–≤–ª–µ–Ω—å –∑–∞ ${newac} —Ä—ñ–∫ –ø–æ –í–∞—à–∏–º –¥–∞–Ω–∏–º`, {
                 reply_markup: {
                   remove_keyboard: true
                 }
               });

               gruopresults(msg, nameArray, data);





             }
           });
       } else {
         bot.sendMessage(msg, '–í–∏–Ω–∏–∫–ª–∞ –ø–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö. –°–ø—Ä–æ–±—É–π—Ç–µ –ø—ñ–∑–Ω—ñ—à–µ.');
       }



     });
    }}


 async function gruopresults(msg, nameArray, data) {

   for (let i = 0; i <= nameArray - 1; i++) {

     console.log(data[i].WebCode);
     if (data[i].Docstatus == '–ø–µ—Ä–µ–≤—ñ—Ä–µ–Ω–æ') {

       await fetch(`${url}/examination/getResultsPDF?ExaminationResultsPDFCode=${data[i].WebCode}&ShowOnlyReady=false`, {
           headers: {
             'Authorization': 'Basic TWVkVGVjaHxNZWRUZWNoV2ViOk1lZFRlY2gxMjMh'
           }
         })
         .then(res => res.arrayBuffer())
         .then(buffer => {
           const fileBufferpdf = Buffer.from(buffer);

           bot.sendDocument(msg, fileBufferpdf, {}, {
             filename: `${data[i].WebCode}.pdf`,
             contentType: 'application/pdf'
           })
           bot.sendMessage(msg, '–ó–∞–ø–∏—Å  ' + `${(i+1)}` + '      \n–î–∞—Ç–∞ –∑–≤–µ—Ä–Ω–µ–Ω–Ω—è: ' + `${data[i].Date} \n–°—Ç–∞—Ç—É—Å –≤–∏–∫–æ–Ω–∞–Ω–Ω—è:  ${data[i].Docstatus}`)
             .catch({
               i
             });

         });

     }

     else {
       bot.sendMessage(msg, `–ó–∞–º–æ–≤–ª–µ–Ω–Ω—è  ${data[i].WebCode} –ø–æ–∫–∏ –≤ –ø—Ä–æ—Ü–µ—Å—ñ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è. `);
       console.log('–ó–∞–º–æ–≤–ª–µ–Ω–Ω—è –≤ –ø—Ä–æ—Ü–µ—Å—ñ —Ä–æ–±–æ—Ç–∏');
     }
   }
 }


 bot.on('contact', (msg) => {
  // phone = (msg.contact.phone_number).slice(-10); // –û—Ç—Ä–∏–º—É—î–º–æ –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω—É –∑ –æ–±'—î–∫—Ç—É contact
  if (QuestionPhoneTriger == true){

   // QuestionPhoneTriger = false;
    setTimeout(()=>{  bot.sendMessage(msg.chat.id, `–í—ñ—Ç–∞—é –í–∞—Å, –ø–æ—Å—Ç–∞–≤—Ç–µ –Ω–∞–º –∑–∞–ø–∏—Ç–∞–Ω–Ω—è –∞–±–æ –æ–∑–≤—É—á—Ç–µ –ø—Ä–æ–±–ª–µ–º—É –∑ —è–∫–æ—é –í–∏ –∑—ñ—Ç–∫–Ω—É–ª–∏—Å—å –≤ –Ω–∞—à—ñ–π –ª–∞–±–æ—Ä–∞—Ç–æ—Ä—ñ—ó. –Ü –º–∏ –≤ –Ω–∞–π–∫–æ—Ä–æ—Ç—à–∏–π —á–∞—Å –∑–≤—è–∂–µ–º–æ—Å—è –∑ –í–∞–º–∏`, {
      reply_markup: {
        force_reply: true
      }
    }).then(sent=>{
     bot.onReplyToMessage(msg.chat.id, sent.message_id, (reply) => {
                       if (reply.text == '/start' || reply.text == undefined || reply.text.length ==0){bot.sendMessage(msg.chat.id,'–í–≤–µ–¥–µ–Ω–æ –Ω–µ–∫–æ—Ä–µ–∫—Ç–Ω–∏–π —Ç–µ–∫—Å—Ç');}else{
       bot.sendMessage(msg.chat.id, `–í–∞—à–µ –∑–∞–ø–∏—Ç–∞–Ω–Ω—è –≤—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–æ –æ–ø–µ—Ä–∞—Ç–æ—Ä—É. –û—á—ñ–∫—É–π—Ç–µ –≤—ñ–¥–ø–æ–≤—ñ–¥—å.`).then(QuestionPhoneTriger = false);
       //  bot.sendMessage(chatId,namer).then((sent)=>{ bot.forwardMessage(-813260675, chatId, sent.message_id); } );
       
       bot.sendMessage(-954144335, `–ù–∞–¥—ñ–π—à–ª–æ –∑–∞–ø–∏—Ç–∞–Ω–Ω—è –≤—ñ–¥ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –¢–µ–ª–µ–≥—Ä–∞–º-–±–æ—Ç–∞ ${sent.chat.first_name}\n     \n–¢–µ–∫—Å—Ç –∑–∞–ø–∏—Ç–∞–Ω–Ω—è:\n ${reply.text}\n –ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω—É: ${userphones[msg.chat.id]}    \n<b>–ù–∞–≥–∞–¥—É—é –ø—Ä–æ –Ω–µ–æ–±—Ö—ñ–¥–Ω—ñ—Å—Ç—å —Ç–µ—Ä–º—ñ–Ω–æ–≤–æ –ø–µ—Ä–µ–¥–∑–≤–æ–Ω–∏—Ç–∏ –∫–ª—ñ–µ–Ω—Ç—É –¥–ª—è –æ–ø—Ä–∞—Ü—é–≤–∞–Ω–Ω—è –∑–≤–µ—Ä–Ω–µ–Ω–Ω—è.</b> `, {
         parse_mode: 'HTML'
       });
     }});});},1200);
  



















  }
   if (msg.chat.id in userphones){}else{userphones[msg.chat.id]= (msg.contact.phone_number).slice(-10);}
   if (msg.chat.id in userburns  && validateDateObj(userburns[msg.chat.id])== true){ 
       bot.sendMessage(msg.chat.id, `–î—è–∫—É—î–º–æ! –í–∞—à –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω—É: ${msg.contact.phone_number}`, GetKeyboradBurnandPhone((msg.contact.phone_number).slice(-10), userburns[msg.chat.id]));
           isdbName(msg.chat.id, Number((msg.contact.phone_number).slice(-10)), userburns[msg.chat.id], GetPeriodBack(1000), GetCurDay())
           .catch(err =>{bot.sendMessage(msg.chat.id,'–ü–æ–º–∏–ª–∫–∞. –í—ñ–¥—Å—É—Ç–Ω—è —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø—Ä–æ –í–∞—Å –≤ –±–∞–∑—ñ –¥–∞–Ω–Ω–∏—Ö MTS Clinic');});

      } 
   
    else {
     // if (QuestionPhoneTriger == false){} else {}
     if (GetTrigerObject[msg.chat.id].PhoneTriger== true){bot.sendMessage(msg.chat.id, `–î—è–∫—É—î–º–æ! –í–∞—à –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω—É: ${msg.contact.phone_number}`, GetKeyboardPhone((msg.contact.phone_number).slice(-10)));
   }
     //----------------------—Ç—É —Ç—Ä–µ–±–∞ –≤—Å–∞—Ç–∏–≤–∏—Ç–∏ –æ–±—Ä–æ–±–∫—É –∑–∞–ø–∏—Ç—É –Ω–∞ —ñ–º—è
    // outputdate = DateMod(databurn);

   }
   if (GetTrigerObject[msg.chat.id].SelectTriger && (userphones[msg.chat.id] != undefined)  && validateDateObj(userburns[msg.chat.id]) && !GetTrigerObject[msg.chat.id].PhoneTriger ){
    bot.sendMessage(msg.chat.id,'–û–±–µ—Ä—ñ—Ç—å –ø–æ—Ç—Ä—ñ–±–Ω–∏–π –ø–µ—Ä—ñ–æ–¥',YearSelect);}



   //bot.sendMessage(msg.chat.id, `–î—è–∫—É—î–º–æ! –í–∞—à –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω—É: ${phone}`,GetKeybOnlyPhone); // –í—ñ–¥–ø—Ä–∞–≤–ª—è—î–º–æ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –∑ –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è–º

   






   console.log(GetTrigerObject);
   console.log(phone);











 });

 let GetKeybNull = {
   reply_markup: {
     keyboard: [
       [{
         text: '–ö—Ä–æ–∫ 1: –ù–∞–¥—ñ—Å–ª–∞—Ç–∏ –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω—É',
         request_contact: true
       }],




       // –í–º–∏–∫–∞—î–º–æ –∑–∞–ø–∏—Ç –Ω–∞ –Ω–∞–¥—Å–∏–ª–∞–Ω–Ω—è –∫–æ–Ω—Ç–∞–∫—Ç—É
       [`–ö—Ä–æ–∫ 2: –î–∞—Ç–∞ –Ω–∞—Ä–æ–¥–∂–µ–Ω–Ω—è`]


     ],
     resize_keyboard: true

   }
 };


const YearSelect = {   reply_markup: {
  inline_keyboard: [
    [{
      text: `1. ${curyear-3}`,
      callback_data: 'button12'
    }],
    [{
      text: `2. ${curyear-2}`,
      callback_data: 'button11'
    }],
    [{
      text: `3. ${curyear-1}`,
      callback_data: 'button9'
    }],
    [{
      text: `4. ${curyear}`,
      callback_data: 'button10'
    }],
    [{
      text: '5. –£—Å—ñ —Ä–æ–∫–∏',
      callback_data: 'button13'
    }]

  ],remove_keyboard: false

}};

 function GetKeyboardPhone(getphone) {
   const GetKeybOnlyPhone = {
     reply_markup: {
       keyboard: [
         [{
           text: `–í–∞—à –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω—É:\n ${getphone} `,
           request_contact: true
         }],




         // –í–º–∏–∫–∞—î–º–æ –∑–∞–ø–∏—Ç –Ω–∞ –Ω–∞–¥—Å–∏–ª–∞–Ω–Ω—è –∫–æ–Ω—Ç–∞–∫—Ç—É
         [`–î–∞—Ç–∞ –Ω–∞—Ä–æ–¥–∂–µ–Ω–Ω—è`]


       ],
       resize_keyboard: true



     }
   };

   return GetKeybOnlyPhone;
 }


 function validateDateObj(dateString) {
  // –®–∞–±–ª–æ–Ω –¥–∞—Ç—ã: –ì–ì–ì–ì-–ú–ú-–î–î
  var pattern = /^\d{4}-\d{2}-\d{2}$/;

  // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ —Å —à–∞–±–ª–æ–Ω–æ–º
  if (!pattern.test(dateString)) {
    return false;
  }

  // –†–∞–∑–±–∏–≤–∞–µ–º —Å—Ç—Ä–æ–∫—É –Ω–∞ —Å–æ—Å—Ç–∞–≤–ª—è—é—â–∏–µ
  var parts = dateString.split('-');
  var year = parseInt(parts[0], 10);
  var month = parseInt(parts[1], 10);
  var day = parseInt(parts[2], 10);

  // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å –¥–∞—Ç—ã
  if (year < 1000 || year > 9999 || month === 0 || month > 12) {
    return false;
  }

  // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–Ω–µ–π –≤ –º–µ—Å—è—Ü–µ
  var maxDay = new Date(year, month, 0).getDate();
  if (day === 0 || day > maxDay) {
    return false;
  }

  // –î–∞—Ç–∞ –ø—Ä–æ—à–ª–∞ –≤—Å–µ –ø—Ä–æ–≤–µ—Ä–∫–∏
  return true;
}


 function validateDate(dateString) {
  // –®–∞–±–ª–æ–Ω –¥–∞—Ç—ã: –¥–¥/–º–º/–≥–≥–≥–≥
  var pattern = /^\d{2}\/\d{2}\/\d{4}$/;

  // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ —Å —à–∞–±–ª–æ–Ω–æ–º
  if (!pattern.test(dateString)) {
    return false;
  }

  // –†–∞–∑–±–∏–≤–∞–µ–º —Å—Ç—Ä–æ–∫—É –Ω–∞ —Å–æ—Å—Ç–∞–≤–ª—è—é—â–∏–µ
  var parts = dateString.split('/');
  var day = parseInt(parts[0], 10);
  var month = parseInt(parts[1], 10);
  var year = parseInt(parts[2], 10);

  // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å –¥–∞—Ç—ã
  if (year < 1000 || year > 9999 || month === 0 || month > 12) {
    return false;
  }

  // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–Ω–µ–π –≤ –º–µ—Å—è—Ü–µ
  var maxDay = new Date(year, month, 0).getDate();
  if (day === 0 || day > maxDay) {
    return false;
  }

  // –î–∞—Ç–∞ –ø—Ä–æ—à–ª–∞ –≤—Å–µ –ø—Ä–æ–≤–µ—Ä–∫–∏
  return true;
}


 function GetKeyboardonlyBurn(getburn) {
   const keyboardOnlyBurn = {
     reply_markup: {
       keyboard: [
         [{
           text: `'–ù–∞–¥—ñ—Å–ª–∞—Ç–∏ –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω—É' `,
           request_contact: true
         }],




         // –í–º–∏–∫–∞—î–º–æ –∑–∞–ø–∏—Ç –Ω–∞ –Ω–∞–¥—Å–∏–ª–∞–Ω–Ω—è –∫–æ–Ω—Ç–∞–∫—Ç—É
         [`–î–∞—Ç–∞ –Ω–∞—Ä–æ–¥–∂–µ–Ω–Ω—è: \n ${getburn}`]


       ],
       resize_keyboard: true



     }
   };
   return keyboardOnlyBurn;
 }

 function GetKeyboradBurnandPhone(getphone, getburn) {
   const keyboardPhoneandBurn = {
     reply_markup: {
       keyboard: [
         [{
           text: `–í–∞—à –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω—É: ${getphone} `,
           request_contact: true
         }],




         // –í–º–∏–∫–∞—î–º–æ –∑–∞–ø–∏—Ç –Ω–∞ –Ω–∞–¥—Å–∏–ª–∞–Ω–Ω—è –∫–æ–Ω—Ç–∞–∫—Ç—É
         [`–î–∞—Ç–∞ –Ω–∞—Ä–æ–¥–∂–µ–Ω–Ω—è: ${getburn}`]


       ],
       resize_keyboard: true



     }
   };
   return keyboardPhoneandBurn;
 }



 function stopInterval(chatId) {
   // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –∏–Ω—Ç–µ—Ä–≤–∞–ª –¥–ª—è –¥–∞–Ω–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
   if (chatId in intervals) {
     // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∏–Ω—Ç–µ—Ä–≤–∞–ª –∏ —É–¥–∞–ª—è–µ–º –µ–≥–æ –∏–∑ –æ–±—ä–µ–∫—Ç–∞ intervals
     clearInterval(intervals[chatId]);
     delete intervals[chatId];

     // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –æ–± –æ—Å—Ç–∞–Ω–æ–≤–∫–µ –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞
     bot.sendMessage(chatId, '–ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏–π –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥ –∑—É–ø–∏–Ω–µ–Ω–æ.');
   } else {
     // –ï—Å–ª–∏ –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞ –Ω–µ—Ç, –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
     bot.sendMessage(chatId, '–ù–µ–º–∞ –¥—ñ—é—á–æ–≥–æ –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥–∞.');
   }
 }



 async function getW(chatid, city) {
   weather(city)
     .then(data => {
       const getweasher = {
         latitude: data[0].lat,
         longitude: data[0].lon,
         city: data[0].local_names.uk,
         appid: '29ebfe90e8a43cfb861bd842ed6ca6f8'
       };
       return getweasher;
     })
     .catch(error => {
       console.error(error);

     })
     .then(getweasher => fetch(`https://api.openweathermap.org/data/2.5/weather?lat=${getweasher.latitude}&lon=${getweasher.longitude}&appid=${getweasher.appid}&units=metric&lang=ua`)
       .then(response => response.json())
       .then(data => {
           const now = new Date();
           const starttime = new Date();
           const hours = now.getHours();
           const day = now.getDay();
           const minute = now.getMinutes();
           starttime.setHours(8);
           starttime.setMinutes(0);

           switch (day) {

             case 0:

               bot.sendMessage(chatid, 'üò¥ –°—å–æ–≥–æ–¥–Ω—ñ –Ω–µ–¥—ñ–ª—è. –ú–µ–¥–∏—á–Ω–∏–π —Ü–µ–Ω—Ç—Ä MTS Clinic - –∑–∞—á–∏–Ω–µ–Ω–æ.');
               break;
             case 1:
             case 2:
             case 3:
             case 4:
             case 5:
               if (hours < 17 && (now.getTime() >= starttime.getTime())) {

                 bot.sendMessage(chatid, ('üëâ –ú–∏, –Ω–∞—Ä–∞–∑—ñ –≤—ñ–¥—á–∏–Ω–µ–Ω—ñ.\n–ì—Ä–∞—Ñ—ñ–∫ —Ä–æ–±–æ—Ç–∏ —Å—å–æ–≥–æ–¥–Ω—ñ: 08:00 - 17:00\n                    \n–ü–æ–≥–æ–¥–∞ –Ω–∞ —Å—å–æ–≥–æ–¥–Ω—ñ. \n–°–ø–ª–∞–Ω—É–π—Ç–µ –¥–æ—Ä–æ–≥—É –∫–æ–º—Ñ–æ—Ä—Ç–Ω–æ –¥–æ –Ω–∞—Å. \n                 \n–ó–∞—Ä–∞–∑ ' + Math.ceil(data.main.temp) + ' ¬∞–° –≤ –º—ñ—Å—Ç—ñ ' + getweasher.city + ' \n–í—ñ–¥—á—É–≤–∞—î—Ç—å—Å—è —è–∫:  ' + Math.round(data.main.feels_like) + ' ¬∞–°' + '\n' + ((data.weather[0].description).charAt(0).toUpperCase() + (data.weather[0].description).slice(1))));



               } else {
                 bot.sendMessage(chatid, 'üò≠–ú–∏, –Ω–∞—Ä–∞–∑—ñ –∑–∞—á–∏–Ω–µ–Ω—ñ. –ê–ª–µ, –í–∏ –º–æ–∂–µ—Ç–µ —Å–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏—Å—å –Ω–∞—à–∏–º–∏ –æ–Ω–ª–∞–π–Ω-–ø–æ—Å–ª—É–≥–∞–º–∏.‚òù');
               }
               break;

             case 6:
               if (hours < 15 && hours >= 8) {
                 bot.sendMessage(chatid, ('üíâüî¨ü©∫üßë‚Äç‚öïÔ∏è\n–ì—Ä–∞—Ñ—ñ–∫ —Ä–æ–±–æ—Ç–∏ —Å—å–æ–≥–æ–¥–Ω—ñ: 08:00 - 15:00\n–°–ø–ª–∞–Ω—É–π—Ç–µ –¥–æ—Ä–æ–≥—É –∫–æ–º—Ñ–æ—Ä—Ç–Ω–æ –¥–æ –Ω–∞—Å.\n                 \n–ü–æ–≥–æ–¥–∞ –Ω–∞ —Å—å–æ–≥–æ–¥–Ω—ñ.\n–ó–∞—Ä–∞–∑ ' + Math.ceil(data.main.temp) + ' ¬∞–° –≤ –º—ñ—Å—Ç—ñ ' + getweasher.city + ' \n–í—ñ–¥—á—É–≤–∞—î—Ç—å—Å—è —è–∫:  ' + Math.round(data.main.feels_like) + ' ¬∞–°' + '\n' + ((data.weather[0].description).charAt(0).toUpperCase() + (data.weather[0].description).slice(1))));
               } else {
                 bot.sendMessage(chatid, 'üò≠ –ú–∏, –Ω–∞—Ä–∞–∑—ñ –∑–∞—á–∏–Ω–µ–Ω—ñ. –ê–ª–µ, –í–∏ –º–æ–∂–µ—Ç–µ —Å–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏—Å—å –Ω–∞—à–∏–º–∏ –æ–Ω–ª–∞–π–Ω-–ø–æ—Å–ª—É–≥–∞–º–∏.‚òù');
               }
               break;





           }













         }


       ).catch(err => {console.log('–ü–æ–º–∏–ª–∫–∞ –≤ —Ñ—É–Ω–∫—Ü—ñ—ó –≤–∏–∫–ª–∏–∫—É –¥–∞–Ω–Ω–∏—Ö –ø–æ–≥–æ–¥–∏. –†—è–¥–æ–∫ 692' + err);})
       );
 }



 async function GetPdfCode(msg, webcode, count) {




   await fetch(`${url}/examination/getResultsPDF?ExaminationResultsPDFCode=${webcode}&ShowOnlyReady=false`, {
       headers: {
         'Authorization': 'Basic TWVkVGVjaHxNZWRUZWNoV2ViOk1lZFRlY2gxMjMh'
       }
     })
     .then(res => res.arrayBuffer())
     .then(buffer => {
       const fileBufferpdf = Buffer.from(buffer);

       bot.sendDocument(msg, fileBufferpdf, {}, {
           filename: `${webcode}.pdf`,
           contentType: 'application/pdf'
         })
         .then(setTimeout(() => {
           (bot.sendMessage(msg, '–í–∏–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –¥–∞–Ω–Ω–∏—Ö –∑–∞–≤–µ—Ä—à–µ–Ω–æ')

           );
         }, 1500));
       countcode++;
       if (countcode == count) {
         clearInterval(intervalId);
         intervalId = 0;
       }

     });


   return true;





 }









 bot.on('message', (msg) => {
   const chatId = msg.chat.id;
   if (msg.contact === undefined){
    console.log( DateRegularexp.test(msg.text));
     if ( validateDate(msg.text) || msg.text == '/start' || msg.text.includes('–î–∞—Ç–∞') || msg.text.includes('–ó—É–ø–∏–Ω–∏—Ç–∏') || QuestionPhoneTriger ){console.log(validateDate(msg.text))}
     else {bot.sendMessage(msg.chat.id,'–í–Ω–µ—Å–µ–Ω–∏–π –Ω–µ–≤—ñ—Ä–Ω–æ —Ñ–æ—Ä–º–∞—Ç –¥–∞—Ç–∏ –Ω–∞—Ä–æ–¥–∂–µ–Ω–Ω—è. –°–ø—Ä–æ–±—É–π—Ç–µ –∑–Ω–æ–≤—É.');}}

   if ( msg.text === '–ó—É–ø–∏–Ω–∏—Ç–∏ –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥') {
     // –û—Ç—Ä–∏–º–∞–Ω–Ω—è –ø–æ—Ç–æ—á–Ω–æ–≥–æ —á–∞—Å—É
     stopInterval(msg.chat.id);

   }







    if (msg.text != undefined){
   if (msg.text.includes('–î–∞—Ç–∞ –Ω–∞—Ä–æ–¥–∂–µ–Ω–Ω—è')) {
     bot.sendMessage(chatId, '–í–≤–µ–¥—ñ—Ç—å —Å–≤–æ—é –¥–∞—Ç—É –Ω–∞—Ä–æ–¥–∂–µ–Ω–Ω—è –≤ —Ñ–æ—Ä–º–∞—Ç—ñ –î–î/–ú–ú/–†–†–†–† - –¥–ª—è —É–Ω—ñ–∫–∞–ª—å–Ω–æ—ó —ñ–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó –≤–∞—Å –≤ –±–∞–∑—ñ –¥–∞–Ω–Ω–∏—Ö –ª–∞–±–æ—Ä–∞—Ç–æ—Ä—ñ—ó MTS Clinic');
     



   }} 



   if (msg.text === '/start') {

     bot.sendSticker(msg.chat.id, 'CAACAgIAAxkBAAEIyH5kTfKJfjKEmYHi8CKOq2f7YZupTwACGCUAAn2PcUrNxIKmFCxpby8E')
       .then(
       
         GetNameDB(msg.chat.id).then(telegram => {
          userburns[msg.chat.id]=telegram._doc.BirthDay;
          userphones[msg.chat.id] = telegram._doc.Phone;
          // actualid = msg.from.id;
         
           bot.sendMessage(chatId, `–í—ñ—Ç–∞—é –í–∞—Å, ${telegram.FullName}\n–í–∞—à –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω—É: 0${telegram._doc.Phone}\n–í–∞—à–∞ –¥–∞—Ç–∞ –Ω–∞—Ä–æ–¥–∂–µ–Ω–Ω—è: ${telegram._doc.BirthDay}`,{
            reply_markup: {
              remove_keyboard: true
            }
          })
             .then(getW(msg.from.id, '–ü—ñ—Å–æ—á–∏–Ω'),

               setTimeout(() => {
                SelectTriger = false;

                 bot.sendMessage(msg.chat.id, '–í–∏–±–µ—Ä—ñ—Ç—å –¥—ñ—é: üëá', InlineKB);



               }, 500)







             );


         })
         .catch(error => {
           console.log('–ü–æ–º–∏–ª–∫–∞:', error);

           setTimeout(() => {
             bot.sendMessage(msg.from.id, `–í—ñ—Ç–∞—é –í–∞—Å, –®–∞–Ω–æ–≤–Ω–∏–π –≤—ñ–¥–≤—ñ–¥—É–≤–∞—á ${msg.from.first_name}`)
             .then(()=>{bot.sendMessage(msg.from.id, '–í–∏–±–µ—Ä—ñ—Ç—å –¥—ñ—é: üëá', InlineKB);});


             



           }, 500);





         })

       );














   }
   if (msg.text === undefined) {} else if (msg.text.length == 15) {
     const number1 = Number(msg.text);
     if (isNaN(number1) == false) {
      

       bot.sendMessage(msg.from.id, 'üò∏ –£–Ω—ñ–∫–∞–ª—å–Ω–∏–π –∫–æ–¥ –≤–≤–µ–¥–µ–Ω–æ –≤—ñ—Ä–Ω–æ - –ø–æ—á–∏–Ω–∞—é –ø–æ—à—É–∫ –í–∞—à–æ–≥–æ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è üîç');

       fetch(`${url}/examination/getResultsPDF?ExaminationResultsPDFCode=${msg.text}&ShowOnlyReady=false`, {
           headers: {
             'Authorization': 'Basic TWVkVGVjaHxNZWRUZWNoV2ViOk1lZFRlY2gxMjMh'
           }
         })
         .then(res => res.arrayBuffer())
         .then(buffer => {
            if (buffer.byteLength < 1023){bot.sendMessage(msg.chat.id,'–ö–æ–¥ –¥–æ—Å—Ç—É–ø—É –≤—ñ–¥—Å—É—Ç–Ω—ñ–π –≤ –±–∞–∑—ñ –¥–∞–Ω–Ω–∏—Ö –ª–∞–±–æ—Ä–∞—Ç–æ—Ä—ñ—ó MTS Clinic. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ñ—Å—Ç—å –Ω–∞–±–æ—Ä—É –∫–æ–º–±—ñ–Ω–∞—Ü—ñ—ó.').then(QuestionPhoneTriger = false);}else

          {
           const fileBufferpdf = Buffer.from(buffer);

           bot.sendDocument(msg.from.id, fileBufferpdf, {}, {
             filename: `${msg.text}.pdf`,
             contentType: 'application/pdf'
           }).then(QuestionPhoneTriger = false);

          }
         })
         .catch(error => {console.error(error);
         QuestionPhoneTriger = false;});

     }
   }




 });




 bot.on('callback_query', (query) => {
   const chatId = query.message.chat.id;
   const data = query.data;

   switch (data) {
     case 'button1':
      QuestionPhoneTriger = true;

       bot.sendMessage(query.message.chat.id, '–í–≤–µ–¥—ñ—Ç—å 15 –∑–Ω–∞—á–Ω–∏–π —É–Ω—ñ–∫–∞–ª—å–Ω–∏–π –∫–æ–¥ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è. –∫–æ–¥ –º–æ–∂–Ω–∞ –∑–Ω–∞–π—Ç–∏ –Ω–∞ –±–ª–∞–Ω–∫—É –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è –∞–±–æ –≤ —Å–º—Å –≤—ñ–¥ –ª–∞–±–æ—Ä–∞—Ç–æ—Ä—ñ—ó –ø—Ä–æ –≥–æ—Ç–æ–≤–Ω—ñ—Å—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤.', {
         reply_markup: {
           remove_keyboard: true
         }
       })
       .then(bot.sendPhoto(query.message.chat.id,demosmspng));


       break;
     case 'button2':
     
      QuestionPhoneTriger = false;
      GetTrigerObject = {
        [query.message.chat.id]: {
          SelectTriger: true,
          BurnTriger: true,
          PhoneTriger:  false,
          StartScan: false,
          arrayyearcount: []
        }};



function processIterations(i) {
  if (i >= 0) {
    return requestdataCount(query.message.chat.id, curyear - i, curyear - i, userphones[query.message.chat.id], userburns[query.message.chat.id])
      .then(res => {

        GetTrigerObject[query.message.chat.id].arrayyearcount.push(res);
         // –î–æ–±–∞–≤–ª—è–µ–º —Ç–µ–∫—É—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ res –≤ –º–∞—Å—Å–∏–≤
        return processIterations(i - 1); // –†–µ–∫—É—Ä—Å–∏–≤–Ω–æ –≤—ã–∑—ã–≤–∞–µ–º —Å–ª–µ–¥—É—é—â—É—é –∏—Ç–µ—Ä–∞—Ü–∏—é —Å —É–º–µ–Ω—å—à–µ–Ω–Ω—ã–º i
      });
  } else {
    return Promise.resolve(); // –í–æ–∑–≤—Ä–∞—â–∞–µ–º —É—Å–ø–µ—à–Ω–æ —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã–π –ø—Ä–æ–º–∏—Å –ø—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ –≤—Å–µ—Ö –∏—Ç–µ—Ä–∞—Ü–∏–π
  }
}

// –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ä–µ–∫—É—Ä—Å–∏–≤–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∏—Ç–µ—Ä–∞—Ü–∏–π
processIterations(3)
  .then(() => {
    if (userphones[query.message.chat.id] && userburns[query.message.chat.id] != undefined){
      
      
      bot.sendMessage(query.message.chat.id, '–í–∏–±–µ—Ä—ñ—Ç—å –ø–µ—Ä—ñ–æ–¥,—è–∫–∏–π –í–∞—Å —Ü—ñ–∫–∞–≤–∏—Ç—å:', {

      reply_markup: {
        inline_keyboard: [
          [{
            text: `1. ${curyear-3}: –ê–Ω–∞–ª—ñ–∑—ñ–≤ (${ GetTrigerObject[query.message.chat.id].arrayyearcount[0]}) `,
            callback_data: 'button12'
          }],
          [{
            text: `2. ${curyear-2}: –ê–Ω–∞–ª—ñ–∑—ñ–≤ (${ GetTrigerObject[query.message.chat.id].arrayyearcount[1]})`,
            callback_data: 'button11'
          }],
          [{
            text: `3. ${curyear-1}: –ê–Ω–∞–ª—ñ–∑—ñ–≤ (${ GetTrigerObject[query.message.chat.id].arrayyearcount[2]})`,
            callback_data: 'button9'
          }],
          [{
            text: `4. ${curyear}: –ê–Ω–∞–ª—ñ–∑—ñ–≤ (${ GetTrigerObject[query.message.chat.id].arrayyearcount[3]}) `,   
            callback_data: 'button10'
          }],
          [{
            text: `5. –£—Å—ñ —Ä–æ–∫–∏: –ê–Ω–∞–ª—ñ–∑—ñ–≤ (${ GetTrigerObject[query.message.chat.id].arrayyearcount.sumArray( GetTrigerObject[query.message.chat.id].arrayyearcount)}) `,
            callback_data: 'button13'
          }]

        ],remove_keyboard: false

      }
});
bot.sendMessage(query.message.chat.id,'–í —Ä–∞–∑—ñ –ø–æ—Ç—Ä–µ–±–∏ —Å–∫–æ—Ä–µ–≥—É–π—Ç–µ —Å–≤–æ—é –¥–∞—Ç—É –Ω–∞—Ä–æ–¥–∂–µ–Ω–Ω—è —Ç–∞ –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω—É —á–µ—Ä–µ–∑ –∫–Ω–æ–ø–∫–∏ –∫–ª–∞–≤—ñ–∞—Ç—É—Ä–∏ , —â–æ –≤–Ω–∏–∑—É.–¢–∞–∫–æ–∂, —è–∫—â–æ –í–∏ —Ä–µ—î—Å—Ç—Ä—É–≤–∞–ª–∏ –¥–æ—Å–ª—ñ–¥–∂–µ–Ω–Ω—è —Å–≤–æ—î—ó –¥–∏—Ç–∏–Ω–∏ –Ω–∞ —Å–≤—ñ–π –Ω–æ–º–µ—Ä, —Ç–æ –≤–≤–µ–¥—ñ—Ç—å –¥–∞—Ç—É –Ω–∞—Ä–æ–¥–∂–µ–Ω–Ω—è –í–∞—à–æ—ó –¥–∏—Ç–∏–Ω–∏ —á–∏ –æ–∫—Ä–µ–º–∏—Ö –¥—ñ—Ç–µ–π —ñ –æ—Ç—Ä–∏–º–∞–π—Ç–µ —ó—Ö–Ω—ñ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏ –¥–æ—Å–ª—ñ–¥–∂–µ–Ω—å.',GetKeyboradBurnandPhone(userphones[query.message.chat.id],userburns[query.message.chat.id] )
// 



).then(GetTrigerObject[query.message.chat.id].PhoneTriger =false);
} else {
   
   bot.sendMessage(query.message.chat.id, '–í–≤–µ–¥—ñ—Ç—å —Å–≤–æ—é –¥–∞—Ç—É –Ω–∞—Ä–æ–¥–∂–µ–Ω–Ω—è –≤ —Ñ–æ—Ä–º–∞—Ç—ñ –î–î/–ú–ú/–†–†–†–† - –¥–ª—è —É–Ω—ñ–∫–∞–ª—å–Ω–æ—ó —ñ–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó –≤–∞—Å –≤ –±–∞–∑—ñ –¥–∞–Ω–Ω–∏—Ö –ª–∞–±–æ—Ä–∞—Ç–æ—Ä—ñ—ó MTS Clinic', {
     reply_markup: {
       remove_keyboard: true
     }
   });

}

  });
      
      
      
      requestdataCount(query.message.chat.id, curyear, curyear, userphones[query.message.chat.id], userburns[query.message.chat.id])
  .then(res => {
 
    return Promise.resolve(res); // –í–µ—Ä–Ω—É—Ç—å –ø—Ä–æ–º–∏—Å –¥–ª—è –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è –ø–æ—Ä—è–¥–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
  })
  .catch(err => {console.log('–í–∏–Ω–∏–∫–ª–∞ –ø–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –∑–≤–µ—Ä–Ω–µ–Ω–Ω—ñ –Ω–∞ –ø—ñ–¥—Ä–∞—Ö—É–Ω–æ–∫ –∫—ñ–ª—å–∫–æ—Å—Ç—ñ –∞–Ω–∞–ª—ñ–∑—ñ–≤'+ err);});
 
   

    

        

        





        
      
      
  
       

       break;
     case 'button3':
       bot.sendMessage(query.message.chat.id, '–ê–¥—Ä–µ—Å–∞ –º–µ–¥–∏—á–Ω–æ–≥–æ —Ü–µ–Ω—Ç—Ä—É MTS Clinic. –º.–ü—ñ—Å–æ—á–∏–Ω, –ù–∞–±–µ—Ä–µ–∂–Ω–∞ 11/1').then(() => {
         bot.sendMessage(query.message.chat.id, `–ú–æ–±—ñ–ª—å–Ω–∏–π —Ç–µ–ª–µ—Ñ–æ–Ω: \n 0932962501\n0960414004\n–ü–æ—Å–ª—É–≥–∏: –∑–∞–±—ñ—Ä –∞–Ω–∞–ª—ñ–∑—ñ–≤, \n–ü—É–Ω–∫—Ç –≤–∞–∫—Ü–∏–Ω–∞—Ü—ñ—ó –≤—ñ–¥ COVID-19.\n`, {
           parse_mode: 'Markdown'
         });
         bot.sendLocation(query.message.chat.id, 49.962673, 36.09681, {
           reply_markup: {
             remove_keyboard: true
           }
         });





       });



       break;
     case 'button4':

       bot.sendMessage(query.message.chat.id, '‚û° –í–∏–±–µ—Ä—ñ—Ç—å –ø–æ—Ç—Ä—ñ–±–Ω—É —Ñ—ñ–ª—ñ—é:', {
         reply_markup: {
           inline_keyboard: [
             [{
               text: 'üîπ–ü—ñ—Å–æ—á–∏–Ω',
               callback_data: 'PointFence1'
             }, {
               text: 'üîπ–•–æ–ª–æ–¥–Ω–∞ –ì–æ—Ä–∞',
               callback_data: 'PointFence7'
             }],
             [{
               text: 'üîπ–ë–∞–≤–∞—Ä—ñ—è',
               callback_data: 'PointFence2'
             }, {
               text: 'üîπ–õ—é–±–æ—Ç–∏–Ω',
               callback_data: 'PointFence8'
             }],
             [{
               text: "‚ùó–ê–µ—Ä–æ–ø–æ—Ä—Ç (–ø—Ä–∞—Ü—é—î)",
               callback_data: 'PointFence3'
             }, {
               text: "üîπ–•–æ–ª–æ–¥–Ω–∞ –ì–æ—Ä–∞, –ø—É–Ω–∫—Ç ‚Ññ2 ",
               callback_data: 'PointFence9'
             }],
             [{
               text: "üîπ–ü—ñ–≤–¥–µ–Ω–Ω–∏–π –≤–æ–∫–∑–∞–ª",
               callback_data: 'PointFence4'
             }, {
               text: "üîπ–ö–æ–º—É–Ω–∞–ª—å–Ω–∏–π —Ä–∏–Ω–æ–∫",
               callback_data: 'PointFence10'
             }],
             [{
               text: "üîπ–†–æ–≥–∞–Ω—å",
               callback_data: 'PointFence5'
             }, {
               text: "üîπ–•–¢–ó",
               callback_data: 'PointFence11'
             }],
             [{
               text: "‚ùó–°–∞–ª—Ç—ñ–≤–∫–∞ (–ø—Ä–∞—Ü—é—î)",
               callback_data: 'PointFence6'
             }],

           ],

         }
       });


       break;
     case 'button5':

       bot.sendMessage(query.message.chat.id, 'üíª –ó–∞–≤–∞–Ω—Ç–∞–∂—É—é –∞–∫—Ç—É–∞–ª—å–Ω–∏–π –ø—Ä–∞–π—Å', {
         reply_markup: {
           remove_keyboard: true
         }
       });

       bot.sendDocument(query.message.chat.id, `C:\\Milamed request analyze\\actualpricemts.xlsx`, {
         caption: '–ê–∫—Ç—É–∞–ª—å–Ω–∏–π –ø—Ä–∞–π—Å –ª–∞–±–æ—Ä–∞—Ç–æ—Ä—ñ—ó Mtsclinic'

       });
       break;
     case 'button6':
       fetch('https://www.mtsclinic.com/_files/ugd/fd4680_7ac7380d6eac480e806fc558e5d80fb9.pdf')
         .then(res => res.arrayBuffer())
         .then(buffer => {
           const fileBuffer = Buffer.from(buffer);
           console.log(fileBuffer);

           bot.sendDocument(chatId, fileBuffer, {
             caption: 'üìã–ê–∫—Ç—É–∞–ª—å–Ω–∏–π –ø—Ä–∞–π—Å –º–µ–¥–∏—á–Ω–æ–≥–æ —Ü–µ–Ω—Ç—Ä—É Mtsclinic'

           }, {
             filename: 'Price.pdf',
             contentType: 'application/pdf'
           });
         });

       break;
     case 'button8':
       bot.sendDocument(query.message.chat.id, `C:\\Telegram\\Priceclinicmilamed.xlsx`, {
         caption: 'üìã–ê–∫—Ç—É–∞–ª—å–Ω–∏–π –ø—Ä–∞–π—Å –º–µ–¥–∏—á–Ω–æ–≥–æ —Ü–µ–Ω—Ç—Ä—É Mtsclinic'

       });

       break;
     case 'button9':
       if (query.message.chat.id == undefined) {} else {
         requestdata(query.message.chat.id, (curyear-1),(curyear-1),userphones[query.message.chat.id],userburns[query.message.chat.id]);
       }

       break;
     case 'button10':
       if (query.message.chat.id == undefined) {} else {
         requestdata(query.message.chat.id, curyear,curyear,userphones[query.message.chat.id],userburns[query.message.chat.id]);
       }


       break;
     case 'button11':
       if (query.message.chat.id == undefined) {} else {
         requestdata(query.message.chat.id, (curyear - 2),(curyear - 2),userphones[query.message.chat.id],userburns[query.message.chat.id]);
       }


       break;
     case 'button12':
       if (query.message.chat.id == undefined) {} else {
         requestdata(query.message.chat.id, (curyear - 3),(curyear - 3),userphones[query.message.chat.id],userburns[query.message.chat.id]);
       }


       break;
     case 'button13':
       if (query.message.chat.id == undefined) {} else {
         requestdata(query.message.chat.id, curyear, 2010,userphones[query.message.chat.id],userburns[query.message.chat.id]);
       }


       break;

     case 'PointFence1':
       bot.sendMessage(query.message.chat.id, `üïê<b><u>–ü—ñ—Å–æ—á–∏–Ω.</u></b>` + '—Ç–µ–ª.:(0932962501,0960414004)(Viber,Telegram)\n–ü—É–Ω–∫—Ç –≤–∞–∫—Ü–∏–Ω–∞—Ü—ñ—ó –≤—ñ–¥ COVID-19\n–ê–¥—Ä–µ—Å–∞: –ù–∞–±–µ—Ä–µ–∂–Ω–∞, 11/1\n–ü–Ω-–ü—Ç —Å 08:00-17:00,\n –°–± —Å 08:00-16:00, \n–ù–¥ —Å 08:00-14:00', {
         reply_markup: {
           remove_keyboard: true
         },
         parse_mode: "HTML"
       });
       break;

     case 'PointFence2':

       bot.sendMessage(query.message.chat.id, `üïê<b><u>–ë–∞–≤–∞—Ä—ñ—è.</u></b>` + '—Ç–µ–ª.: (0932962507)(Viber)\n–ê–¥—Ä–µ—Å–∞: –ø—Ä–æ—Å–ø–µ–∫—Ç –ù–æ–≤–æ-–ë–∞–≤–∞—Ä—Å—å–∫–∏–π, 70\n–ü–Ω-–°–± —Å 08:00-12:00, –ù–¥ (–≤–∏—Ö—ñ–¥–Ω–∏–π)', {
         reply_markup: {
           remove_keyboard: true
         },
         parse_mode: "HTML"
       });
       break;
     case 'PointFence3':
       bot.sendMessage(query.message.chat.id, `üïê<b><u>–ê–µ—Ä–æ–ø–æ—Ä—Ç.</u></b>` + ' —Ç–µ–ª.:(0932962509)(Viber) (–ó–ù–û–í–£ –ü–†–ê–¶–Æ–Ñ)\n–ê–¥—Ä–µ—Å–∞: –ü—Ä–æ—Å–ø–µ–∫—Ç –ì–∞–≥–∞—Ä–∏–Ω–∞, 316–ë\n–ü–Ω-–ü—Ç —Å 07:30-12:00, –ù–¥ (–≤–∏—Ö—ñ–¥–Ω–∏–π)', {
         reply_markup: {
           remove_keyboard: true
         },
         parse_mode: "HTML"
       });


       break;

     case 'PointFence4':
       bot.sendMessage(query.message.chat.id, `üïê<b><u>–ü—ñ–≤–¥–µ–Ω–Ω–∏–π –≤–æ–∫–∑–∞–ª.</u></b>` + ' —Ç–µ–ª.:(0932962504)(Viber,Telegram)\n–ê–¥—Ä–µ—Å–∞: –ö–æ—Ç–ª—è—Ä–∞, 12\n–ü–Ω-–°–± —Å 07:30-12:00, –ù–¥ (–≤–∏—Ö—ñ–¥–Ω–∏–π)‚Äã', {
         reply_markup: {
           remove_keyboard: true
         },
         parse_mode: "HTML"
       });

       break;
     case 'PointFence5':
       bot.sendMessage(query.message.chat.id, `üïê<b><u>–†–æ–≥–∞–Ω—å. </u></b>` + '—Ç–µ–ª.:(0932962505)(Viber)\n–ê–¥—Ä–µ—Å–∞: –°–µ—Ä–≥—ñ—è –ì—Ä–∏—Ü–µ–≤—Ü—è, 9\n–ü–Ω-–°–± —Å 07:30-12:00, –ù–¥ (–≤–∏—Ö—ñ–¥–Ω–∏–π)‚Äã', {
         reply_markup: {
           remove_keyboard: true
         },
         parse_mode: "HTML"
       });

       break;

     case 'PointFence6':
       bot.sendMessage(query.message.chat.id, `üïê<b><u>–°–∞–ª—Ç—ñ–≤–∫–∞. </u></b>` + '—Ç–µ–ª.:(0932962506)(Viber) (–ó–ù–û–í–£ –ü–†–ê–¶–Æ–Ñ)\n–ê–¥—Ä–µ—Å–∞: –¢—Ä–∞–∫—Ç–æ—Ä–æ–±—É–¥—ñ–≤–Ω–∏–∫—ñ–≤, 160–í\n–ü–Ω-–°–± —Å 07:30-12:00, –ù–¥ (–≤–∏—Ö—ñ–¥–Ω–∏–π)‚Äã', {
         reply_markup: {
           remove_keyboard: true
         },
         parse_mode: "HTML"
       });

       break;

     case 'PointFence7':
       bot.sendMessage(query.message.chat.id, `üïê<b><u>–•–æ–ª–æ–¥–Ω–∞ –ì–æ—Ä–∞. </u></b>` + '—Ç–µ–ª.:(0932962502)(Viber)\n–ê–¥—Ä–µ—Å–∞: –ü–æ–ª—Ç–∞–≤—Å—å–∫–∏–π —à–ª—è—Ö, 152 (–î–∏—Ç—è—á–∞ –ø–æ–ª—ñ–∫–ª—ñ–Ω—ñ–∫–∞ ‚Ññ19 –∫–∞–±—ñ–Ω–µ—Ç ‚Ññ8)\n–ü–Ω-–°–± —Å 08:00-12:00, –ù–¥ (–≤–∏—Ö—ñ–¥–Ω–∏–π)‚Äã', {
         reply_markup: {
           remove_keyboard: true
         },
         parse_mode: "HTML"
       });

       break;
     case 'PointFence8':
       bot.sendMessage(query.message.chat.id, `üïê<b><u>–õ—é–±–æ—Ç–∏–Ω. </u></b>` + '—Ç–µ–ª.:(0932962508)(Viber)\n–ê–¥—Ä–µ—Å–∞: –®–µ–≤—á–µ–Ω–∫–∞, 15 (–∫–∞–±. 2) (–ú—ñ—Å—å–∫–∞ –ø–æ–ª—ñ–∫–ª—ñ–Ω—ñ–∫–∞)\n–ü–Ω-–°–± —Å 08:00-12:00, –ù–¥ (–≤–∏—Ö—ñ–¥–Ω–∏–π)‚Äã', {
         reply_markup: {
           remove_keyboard: true
         },
         parse_mode: "HTML"
       });

       break;
     case 'PointFence9':
       bot.sendMessage(query.message.chat.id, `üïê<b><u>–•–æ–ª–æ–¥–Ω–∞ –ì–æ—Ä–∞. </u></b>` + ' —Ç–µ–ª.:(0637078733)(Viber)\n–ê–¥—Ä–µ—Å–∞: –î—É–¥–∏–Ω—Å—å–∫–æ—ó, 1–∞\n–ü–Ω-–°–± —Å 07:30-12:00, –ù–¥ (–≤–∏—Ö—ñ–¥–Ω–∏–π)‚Äã‚Äã', {
         reply_markup: {
           remove_keyboard: true
         },
         parse_mode: "HTML"
       });

       break;
     case 'PointFence10':
       bot.sendMessage(query.message.chat.id, `üïê<b><u>–ö–æ–º—É–Ω–∞–ª—å–Ω–∏–π —Ä–∏–Ω–æ–∫. </u></b>` + '—Ç–µ–ª.:(0932962513)(Viber)\n–ê–¥—Ä–µ—Å–∞: –õ—å–≤–∞ –õ–∞–Ω–¥–∞—É, 8\n(–ø—Ä–∞—Ü—é—î –∑–∞ —ñ–Ω–¥–∏–≤—ñ–¥—É–∞–ª—å–Ω–∏–º –≥—Ä–∞—Ñ—ñ–∫–æ–º)‚Äã', {
         reply_markup: {
           remove_keyboard: true
         },
         parse_mode: "HTML"
       });

       break;
     case 'PointFence11':
       bot.sendMessage(query.message.chat.id, `üïê<b><u>–•–¢–ó. </u></b>` + ' —Ç–µ–ª.:(932962510)(Viber)\n–ê–¥—Ä–µ—Å–∞: –ø—Ä-—Ç. –û–ª–µ–∫—Å–∞–Ω–¥—Ä—ñ–≤—Å—å–∫–∏–π, 124\n–ü–Ω-–°–± —Å 07:30-12:00, –ù–¥ (–≤–∏—Ö—ñ–¥–Ω–∏–π)‚Äã', {
         reply_markup: {
           remove_keyboard: true
         },
         parse_mode: "HTML"
       })

       break;
     case 'PointFence12':
       bot.sendMessage(query.message.chat.id, "–ú–æ–±—ñ–ª—å–Ω–∏–π —Ç–µ–ª–µ—Ñ–æ–Ω:\n0961912392\n–ü–æ—Å–ª—É–≥–∏: –∑–∞–±—ñ—Ä –∞–Ω–∞–ª—ñ–∑—ñ–≤,\n–ì—Ä–∞—Ñ—ñ–∫ —Ä–æ–±–æ—Ç–∏: –ø–æ–Ω–µ–¥—ñ–ª–æ–∫-–ø‚Äô—è—Ç–Ω–∏—Ü—è 08:30-15:00\n—Å—É–±–æ—Ç–∞, –Ω–µ–¥—ñ–ª—è-–≤–∏—Ö—ñ–¥–Ω–∏–π\n    \n–ü–æ—Å–ª—É–≥–∏ :–£–ó–î.\n–ú–æ–±—ñ–ª—å–Ω–∏–π —Ç–µ–ª–µ—Ñ–æ–Ω: 0964721455\n–ì—Ä–∞—Ñ—ñ–∫ —Ä–æ–±–æ—Ç–∏: –ø–æ–Ω–µ–¥—ñ–ª–æ–∫-–ø‚Äô—è—Ç–Ω–∏—Ü—è 08:00-16:00\n—Å—É–±–æ—Ç–∞, –Ω–µ–¥—ñ–ª—è-–≤–∏—Ö—ñ–¥–Ω–∏–π\n", {
         parse_mode: 'HTML'
       });

       break;

     case 'homeorder':
     
       const now = new Date();
       let day = now.getDay();
       if (day != 0 && day != 6) {
         getWorkperiodstatus = isWorkingTime('8:00', '17:00'); //17:00
       } else if (day == 6) {
         getWorkperiodstatus = isWorkingTime('8:00', '16:00'); //16
       } else {
         getWorkperiodstatus = false;
       }


       if (getWorkperiodstatus) { 
        QuestionPhoneTriger = false;

         bot.sendMessage(query.message.chat.id, `üí≥ –í–∞—Ä—Ç—ñ—Å—Ç—å –ø–æ—Å–ª—É–≥–∏ –≤ –º–µ–∂–∞—Ö –º.–ü—ñ—Å–æ—á–∏–Ω 150 –≥—Ä–Ω.\n –ó–∞ –º–µ–∂—ñ –º—ñ—Å—Ç–∞ - —Ü—ñ–Ω–∞ —ñ–Ω–¥–∏–≤—ñ–¥—É–ª—å–Ω–∞ –≤ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ –≤—ñ–¥ –∫—ñ–Ω—Ü–µ–≤–æ—ó –≤–∞—Ä—Ç–æ—Å—Ç—ñ –ø–æ—Å–ª—É–≥ —Ç–∞–∫—Å—ñ.\n      \n üìù –ë—É–¥—å-–ª–∞—Å–∫–∞, –∑–∞–ø–æ–≤–Ω—ñ—Ç—å –∫–æ—Ä–æ—Ç–∫—É –∞–Ω–∫–µ—Ç—É —ñ –Ω–∞—à –æ–ø–µ—Ä–∞—Ç–æ—Ä –∑–∞—Ç–µ–ª–µ—Ñ–æ–Ω—É—î –í–∞–º –¥–ª—è —É—Ç–æ—á–Ω–µ–Ω–Ω—è —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó —â–æ–¥–æ –º—ñ—Å—Ü—è –π —á–∞—Å—É –∑–∞–±–æ—Ä—É —Ç–∞ –∫—ñ–Ω—Ü–µ–≤–æ—ó –≤–∞—Ä—Ç–æ—Å—Ç—ñ –¥–∞–Ω–æ—ó –ø–æ—Å–ª—É–≥–∏.`);

         setTimeout(() => {


           bot.sendMessage(query.message.chat.id, '‚ùì –í–∞—à–µ –Ü–º\'—è', {
               reply_markup: {
                 force_reply: true
               }
             })
             .then((sent) => {
             
               bot.onReplyToMessage(query.message.chat.id, sent.message_id, (reply) => {
                 namer = reply.text;
                 console.log(namer);

                 bot.sendMessage(query.message.chat.id, `üì±–í–∞—à —Ç–µ–ª–µ—Ñ–æ–Ω. –ü—Ä–∏–∫–ª–∞–¥: 0501234567`, {
                   reply_markup: {
                     force_reply: true // –ó–∞–ø–∏—Ç—É—î–º–æ –≤—ñ–¥–ø–æ–≤—ñ–¥—å –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
                   }
                 }).then((sent) => {
                 
                   bot.onReplyToMessage(query.message.chat.id, sent.message_id, (reply) => {
                     orderphone = reply.text;
                     if (orderphone.length == 10){
                     console.log(orderphone);
                     bot.sendMessage(query.message.chat.id, 'üíÅ‚Äç‚ôÄÔ∏è–î–µ –í–∞–º –∑—Ä—É—á–Ω–æ –æ—Ç—Ä–∏–º–∞—Ç–∏ –ø–æ—Å–ª—É–≥—É. –ù–∞–ø–∏—à—ñ—Ç—å –∞–¥—Ä–µ—Å—É –≤ —Ñ–æ—Ä–º–∞—Ç—ñ (–º—ñ—Å—Ç–æ/–≤—É–ª–∏—Ü—è/–Ω–æ–º–µ—Ä –±—É–¥–∏–Ω–∫—É/–∫–≤–∞—Ä—Ç–∏—Ä–∏)', {
                       reply_markup: {
                         force_reply: true
                       }
                     }).then((sent) => {
                

                       bot.onReplyToMessage(query.message.chat.id, sent.message_id, (reply) => {
                         homeadress = reply.text;
                         console.log(homeadress);

                         bot.sendMessage(query.message.chat.id, 'üôè–ö–æ–ª–∏ –í–∞–º –∑—Ä—É—á–Ω–æ –æ—Ç—Ä–∏–º–∞—Ç–∏ –ø–æ—Å–ª—É–≥—É. –ù–∞–ø–∏—à—ñ—Ç—å –±–∞–∂–∞–Ω—É –¥–∞—Ç—É –≤–∏–∫–ª–∏–∫—É —ñ —á–∞—Å –≤ —Ñ–æ—Ä–º–∞—Ç—ñ (–î–î.–ú–ú.–†–†–†–†-–ì–ì.–•–•)', {
                           reply_markup: {
                             force_reply: true
                           }
                         }).then((sent) => {
                
                          
                           bot.onReplyToMessage(query.message.chat.id, sent.message_id, (reply) => {
                            QuestionPhoneTriger = false;
                             const ordertime = reply.text;
                            
                             let todayfile = new Date();
                             const formattedDate = todayfile.toLocaleString('uk-UA', {
                               year: 'numeric',
                               month: '2-digit',
                               day: '2-digit',
                               hour: '2-digit',
                               minute: '2-digit',
                               second: '2-digit',
                               hour12: false
                             });
                             const ordernum = randomize();



                             if (orderphone.length == 10) {

                               GetNameDB(query.message.chat.id).then(telegram => {
                              
                                     bot.sendMessage(query.message.chat.id, `–í—ñ—Ç–∞—é –í–∞—Å, ${telegram.FullName}\n–í–∞—à –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω—É: 0${telegram._doc.Phone}\n–í–∞—à–∞ –¥–∞—Ç–∞ –Ω–∞—Ä–æ–¥–∂–µ–Ω–Ω—è: ${telegram._doc.BirthDay}`);


                                     bot.sendMessage(query.message.chat.id, `${ordernum}\n–î—è–∫—É—é, ${telegram.FullName}. –í–∞—à–µ –∑–≤–µ—Ä–Ω–µ–Ω–Ω—è –∑–±–µ—Ä–µ–∂–µ–Ω–æ —ñ –ø–µ—Ä–µ–¥–∞–Ω–æ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞–ª—å–Ω–æ–º—É –ø—Ä–∞—Ü—ñ–≤–Ω–∏–∫—É.\n –ß–µ—Ä–µ–∑ –¥–µ—è–∫–∏–π —á–∞—Å –∑ –í–∞–º–∏ –∑–≤—è–∂—É—Ç—å—Å—è —â–æ–¥–æ —É—Ç–æ—á–Ω–µ–Ω–Ω—è –¥–µ—Ç–∞–ª–µ–π. `)
                                       .then(




                                         fs.appendFile('./bot_logmts.txt', `[${todayfile}]\n–ù–∞–¥—ñ–π—à–ª–æ –∑–≤–µ—Ä–Ω–µ–Ω–Ω—è –≤—ñ–¥ –∫–ª—ñ–µ–Ω—Ç–∞ –Ω–∞ –∑–∞–±—ñ—Ä –∫—Ä–æ–≤—ñ –Ω–∞ –¥–æ–º—É\n${ordernum}\n–Ü–º\'—è: ${namer}\n–¢–µ–ª–µ—Ñ–æ–Ω:  ${orderphone}\n–ê–¥—Ä–µ—Å–∞ –≤–∏–∫–ª–∏–∫—É: ${homeadress}\n–ë–∞–∂–∞–Ω–∞ –¥–∞—Ç–∞ —Ç–∞ —á–∞—Å: ${ordertime}\n–í–∫–∞–∑–∞–Ω–µ —ñ–º\'—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –≤ –∞–Ω–∫–µ—Ç—ñ: ${namer}\n–ó–Ω–∞–π–¥–µ–Ω–µ –ø–æ–≤–Ω–µ –Ü–º\'—è –≤ –±–∞–∑—ñ –¥–∞–Ω–∏—Ö:  ${telegram.FullName}`, (err) => {
                                           if (err) throw err;
                                           bot.sendMessage(-954144335, `–ù–∞–¥—ñ–π—à–ª–æ –∑–≤–µ—Ä–Ω–µ–Ω–Ω—è –≤—ñ–¥ –∫–ª—ñ–µ–Ω—Ç–∞ –Ω–∞ –∑–∞–±—ñ—Ä –∫—Ä–æ–≤—ñ –Ω–∞ –¥–æ–º—É\n<b>${ordernum}</b>\n     \n–Ü–º\'—è: ${namer}\n–¢–µ–ª–µ—Ñ–æ–Ω: <b> ${orderphone}</b>\n–ê–¥—Ä–µ—Å–∞ –≤–∏–∫–ª–∏–∫—É: ${homeadress}\n–ë–∞–∂–∞–Ω–∞ –¥–∞—Ç–∞ —Ç–∞ —á–∞—Å: ${ordertime}\n–í–∫–∞–∑–∞–Ω–µ —ñ–º\'—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –≤ –∞–Ω–∫–µ—Ç—ñ: ${namer}\n–ó–Ω–∞–π–¥–µ–Ω–µ –ø–æ–≤–Ω–µ –Ü–º\'—è –≤ –±–∞–∑—ñ –¥–∞–Ω–∏—Ö:  ${telegram.FullName}\n       \n<b>–ù–∞–≥–∞–¥—É—é –ø—Ä–æ –Ω–µ–æ–±—Ö—ñ–¥–Ω—ñ—Å—Ç—å —Ç–µ—Ä–º—ñ–Ω–æ–≤–æ –ø–µ—Ä–µ–¥–∑–≤–æ–Ω–∏—Ç–∏ –∫–ª—ñ–µ–Ω—Ç—É –¥–ª—è –æ–ø—Ä–∞—Ü—é–≤–∞–Ω–Ω—è –∑–≤–µ—Ä–Ω–µ–Ω–Ω—è.</b> `, {
                                             parse_mode: 'HTML'
                                           });
                                           console.log('–î–∞–Ω—ñ –±—É–ª–∏ —É—Å–ø—ñ—à–Ω–æ –¥–æ–ø–∏—Å–∞–Ω—ñ –≤ –∫—ñ–Ω–µ—Ü—å —Ñ–∞–π–ª—É');
                                         })


                                       );



                                   }



                                 )

                                 .catch(err => {
                                   trimmedStr = '–®–∞–Ω–æ–≤–Ω–∏–π –∫–ª—ñ–µ–Ω—Ç, —â–æ –æ–±–∏—Ä–∞—î—Ç–µ –Ω–∞—Å.';
                                   bot.sendMessage(query.message.chat.id, `${ordernum}\n–î—è–∫—É—é, ${trimmedStr}. –í–∞—à–µ –∑–≤–µ—Ä–Ω–µ–Ω–Ω—è –∑–±–µ—Ä–µ–∂–µ–Ω–æ —ñ –ø–µ—Ä–µ–¥–∞–Ω–æ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞–ª—å–Ω–æ–º—É –ø—Ä–∞—Ü—ñ–≤–Ω–∏–∫—É.\n –ß–µ—Ä–µ–∑ –¥–µ—è–∫–∏–π —á–∞—Å –∑ –í–∞–º–∏ –∑–≤—è–∂—É—Ç—å—Å—è —â–æ–¥–æ —É—Ç–æ—á–Ω–µ–Ω–Ω—è –¥–µ—Ç–∞–ª–µ–π. `)

                                   bot.sendMessage(-954144335, `–ù–∞–¥—ñ–π—à–ª–æ –∑–≤–µ—Ä–Ω–µ–Ω–Ω—è –≤—ñ–¥ –∫–ª—ñ–µ–Ω—Ç–∞ –Ω–∞ –∑–∞–±—ñ—Ä –∫—Ä–æ–≤—ñ –Ω–∞ –¥–æ–º—É\n<b>${ordernum}</b>\n     \n–Ü–º\'—è: ${namer}\n–¢–µ–ª–µ—Ñ–æ–Ω: <b> ${orderphone}</b>\n–ê–¥—Ä–µ—Å–∞ –≤–∏–∫–ª–∏–∫—É: ${homeadress}\n–ë–∞–∂–∞–Ω–∞ –¥–∞—Ç–∞ —Ç–∞ —á–∞—Å: ${ordertime}\n       \n<b>–ù–∞–≥–∞–¥—É—é –ø—Ä–æ –Ω–µ–æ–±—Ö—ñ–¥–Ω—ñ—Å—Ç—å —Ç–µ—Ä–º—ñ–Ω–æ–≤–æ –ø–µ—Ä–µ–¥–∑–≤–æ–Ω–∏—Ç–∏ –∫–ª—ñ–µ–Ω—Ç—É –¥–ª—è –æ–ø—Ä–∞—Ü—é–≤–∞–Ω–Ω—è –∑–≤–µ—Ä–Ω–µ–Ω–Ω—è.</b> `, {
                                     parse_mode: 'HTML'
                                   });

                                 });
                             } else {
                               bot.sendMessage(query.message.chat.id, '–ù–æ–º–µ—Ä –º–æ–±—ñ–ª—å–Ω–æ–≥–æ –≤–≤–µ–¥–µ–Ω–æ –Ω–µ –≤—ñ—Ä–Ω–æ. –î–æ–≤–∂–∏–Ω–∞ –Ω–æ–º–µ—Ä—É –ø–æ–≤–∏–Ω–Ω–∞ –±—É—Ç–∏ 10 —Ü–∏—Ñ—Ä. \n –ü–æ—á–Ω—ñ—Ç—å –∑–∞–ø–æ–≤–Ω–µ–Ω–Ω—è –∞–Ω–∫–µ—Ç–∏ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è —Å–ø–æ—á–∞—Ç–∫—É - —á–µ—Ä–µ–∑ –≥–æ–ª–æ–≤–Ω–µ –º–µ–Ω—é. –î—è–∫—É—î–º–æ –∑–∞ –ø–æ—Ä–æ–∑—É–º—ñ–Ω–Ω—è');
                             }






                           });



                         });   


                       });


                     }); }  else {
                      
                      bot.sendMessage(query.message.chat.id,'–ü–æ–º–∏–ª–∫–∞: –í–Ω–µ—Å–µ–Ω–æ –Ω–µ–∫–æ—Ä–µ–∫—Ç–Ω–∏–π –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω—É. –ü–æ—á–Ω—ñ—Ç—å –∑–∞–ø–æ–≤–Ω–µ–Ω–Ω—è –∞–Ω–∫–µ—Ç–∏ —Å–ø–æ—á–∞—Ç–∫—É –∑ –≥–æ–ª–æ–≤–Ω–æ–≥–æ –º–µ–Ω—é –±–æ—Ç–∞, —á–µ—Ä–µ–∑ –∫–Ω–æ–ø–∫—É Menu - /start ')
                      
                      console.log('Total Fuck');}


                   });


                 });


               });

             });




         }, 1000);





       } else {
         bot.sendMessage(query.message.chat.id, 'üò™ –ú–∏, –Ω–∞—Ä–∞–∑—ñ –∑–∞—á–∏–Ω–µ–Ω—ñ. –ó–≤–µ—Ä–Ω–µ–Ω–Ω—è –æ–±—Ä–æ–±–ª—è—é—Ç—å—Å—è –ª–∏—à–µ –≤ —Ä–æ–±–æ—á–∏–π —á–∞—Å.');
       };


       break;

     case 'monitor':
      QuestionPhoneTriger = false;
     GetTrigerObject = {
        [query.message.chat.id]: {
          SelectTriger: false,
          BurnTriger: false,
          PhoneTriger: true,
          StartScan: true
        }
      };
      // BurnTriger = false;
       //PhoneTriger = true;
  
       

       GetNameDB(query.message.chat.id)
        
         .then(telegram => {
           outputdate = telegram._doc.BirthDay;
           bot.sendMessage(query.message.chat.id, `–í—ñ—Ç–∞—é –í–∞—Å, ${telegram.FullName}\n–í–∞—à –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω—É: 0${telegram._doc.Phone}\n–í–∞—à–∞ –¥–∞—Ç–∞ –Ω–∞—Ä–æ–¥–∂–µ–Ω–Ω—è: ${telegram._doc.BirthDay} `)
             .then(bot.sendMessage(query.message.chat.id, '–ó–∞–ø—É—Å–∫–∞—é —Å–∏—Å—Ç–µ–º—É –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥—É –∞–∫—Ç—É–∞–ª—å–Ω–∏—Ö –∑–∞–º–æ–≤–ª–µ–Ω—å –≤ –ª–∞–±–æ—Ä–∞—Ç–æ—Ä—ñ—ó. –°–∫–∞–Ω—É–≤–∞–Ω–Ω—è –∑–º—ñ–Ω —Å—Ç–∞—Ç—É—Å—É –≤–∏–∫–æ–Ω–∞–Ω–Ω—è —ñ—Å–Ω—É—é—á–∏—Ö –¥–æ—Å–ª—ñ–¥–∂–µ–Ω—å –ø—Ä–æ—Ö–æ–¥–∏—Ç—å —â–æ 15 —Ö–≤.', {
                 reply_markup: {
                   keyboard: [
                     [{
                       text: '–ó—É–ø–∏–Ω–∏—Ç–∏ –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥',
                       request_contact: false,



                     }, ]
                   ],
                   resize_keyboard: false

                 }
               })
               .then(data => {

                 if ((query.message.chat.id in intervals) == false) {


                   intervalId = setInterval(() => {


                     const currentTime = new Date();

                     // –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è –±–∞–∂–∞–Ω–æ–≥–æ —á–∞—Å—É
                     const desiredTime = new Date();
                     desiredTime.setHours(23);
                     desiredTime.setMinutes(50);

                     // –ü–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è –≥–æ–¥–∏–Ω
                     if (currentTime <= desiredTime) {
                       console.log('–ß–∞—Å –º–µ–Ω—à–∏–π –∞–±–æ –¥–æ—Ä—ñ–≤–Ω—é—î 23:50');
                       GetPackResults(telegram._doc.BirthDay, telegram._doc.Phone, GetPeriodBack(1000), GetCurDay())
                         .then(response => {

                           if (response.ok) {
                             response.json()
                               .then(data => {
                                 console.log(data);

                                 if (data.length == 0) {
                                   bot.sendMessage(query.message.chat.id, '–£ –í–∞—Å –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ –∞–Ω–∞–ª—ñ–∑—ñ–≤ –¥–æ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –≤ –ø–æ—Ç–æ—á–Ω–æ–º—É –ø–µ—Ä—ñ–æ–¥—ñ.');
                                   stopInterval(query.message.chat.id);
                                 }
                                 for (let i = 0; i < data.length; i++) {
                                   const resarray = data[i];
                                   isAlreadySent = false;
                                   for (let j = 0; j < ArrayCheckAnalyze.length; j++) {
                                     if (resarray.Docstatus == '—Å–∫–∞—Å–æ–≤–∞–Ω–æ') {
                                       continue;
                                     }
                                     const item = ArrayCheckAnalyze[j];
                                     if (resarray.WebCode == item) {
                                       console.log(`–¶—ñ –¥–∞–Ω—ñ —è –≤–∂–µ –ø–µ—Ä–µ–¥–∞–≤: ${resarray.WebCode}`);
                                       isAlreadySent = true;
                                       //break;
                                     }
                                   }
                                   if (!isAlreadySent) {
                                     if (resarray.Docstatus == '–ø–µ—Ä–µ–≤—ñ—Ä–µ–Ω–æ') {
                                       if (ArrayCheckAnalyze.length >= 0) {
                                         bot.sendMessage(query.message.chat.id, `–ó–Ω–∞–π–¥–µ–Ω–æ –¥–æ—Å–ª—ñ–¥–∂–µ–Ω–Ω—è –≤ —Å—Ç–∞—Ç—É—Å—ñ: ${resarray.Docstatus}. –ù–∞–¥—Å–∏–ª–∞—é –π–æ–≥–æ –í–∞–º`)
                                           .then(ArrayCheckAnalyze.push(resarray.WebCode));
                                       }


                                       GetPdfCode(query.message.chat.id, resarray.WebCode, data.length);
                                     } else {
                                       if (ii == true) {




                                         setTimeout(() => {
                                           if (resarray.Docstatus != '—Å–∫–∞—Å–æ–≤–∞–Ω–æ') {
                                             bot.sendMessage(query.message.chat.id, `–¢–∞–∫–æ–∂ –∑–Ω–∞–π–¥–µ–Ω–æ  –¥–æ—Å–ª—ñ–¥–∂–µ–Ω–Ω—è –≤ —Å—Ç–∞—Ç—É—Å—ñ: ${resarray.Docstatus}. –û—á—ñ–∫—É–π—Ç–µ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è`, {
                                               reply_markup: {
                                                 remove_keyboard: false
                                               }
                                             });
                                           }
                                         }, 6000);
                                         ii = false;




                                       }
                                     }

                                   }
                                 }






                               });
                           }
                         });

                     } else {
                       stopInterval(query.message.chat.id);
                       console.log('–ß–∞—Å –±—ñ–ª—å—à–∏–π –∑–∞ 23:59');
                       bot.sendMessage(query.message.chat.id, '–ó—É–ø–∏–Ω–∫–∞ –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥—É –ø–æ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—é –∫–∞–ª–µ–Ω–¥–∞—Ä–Ω–æ—ó –¥–æ–±–∏. –î–ª—è –ø—Ä–æ–¥–æ–≤–∂–µ–Ω–Ω—è –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥—É –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç—ñ—Ç—å –ø–æ—Å–ª—É–≥—É –≤ –Ω–æ–≤—ñ–π –∫–∞–ª–µ–Ω–¥–∞—Ä–Ω—ñ–π –¥–æ–±—ñ.');
                     }


                     // telegram._doc.BirthDay,telegram._doc.Phone,'01-01-2023','12-21.2023'
                   }, timepause);
                   intervals[query.message.chat.id] = intervalId;



                 } else {
                   bot.sendMessage(query.message.chat.id, `‚ö†	–ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ –≤–∂–µ –∑–∞–ø—É—â–µ–Ω–æ. ‚ö†	`);
                 }
               })







             );

         })
         .catch(err => {
           bot.sendMessage(query.message.chat.id, '–£ –º–µ–Ω–µ –≤—ñ–¥—Å—É—Ç–Ω—ñ –¥–∞–Ω—ñ –ø—Ä–æ –í–∞—Å. –î–ª—è –∑–∞–ø—É—Å–∫—É –≤—ñ–¥—Å—Ç–µ–∂–µ–Ω–Ω—è –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—ñ –≤–∏–∫–æ–Ω–∞–Ω–Ω–Ω—è –¥–æ—Å–ª—ñ–¥–∂–µ–Ω–Ω—å, –ø–æ—Ç—Ä—ñ–±–Ω–æ –æ—Ç—Ä–∏–º–∞—Ç–∏ –≤—ñ–¥ –í–∞—Å, –¥–∞—Ç—É –Ω–∞—Ä–æ–¥–∂–µ–Ω–Ω—è —ñ –í–∞—à –Ω–æ–º–µ—Ä –º–æ–±—ñ–ª—å–Ω–æ–≥–æ —Ç–µ–ª–µ—Ñ–æ–Ω—É, —è–∫–∏–π –í–∏ —Ä–µ—î—Å—Ç—Ä—É–≤–∞–ª–∏ –≤ –ª–∞–±–æ—Ä–∞—Ç–æ—Ä—ñ—ó', GetKeybNull);



         });









       break;



     case 'question':

     GetTrigerObject = {
      [query.message.chat.id]: {
        SelectTriger: true,
        BurnTriger: true,
        PhoneTriger:  true,
        StartScan: false
      }};


      QuestionPhoneTriger = true ;
       const nowq = new Date();
       let dayq = nowq.getDay();
       if (dayq != 0 && dayq != 6) {
         getWorkperiodstatus = isWorkingTime('08:00', '17:00'); //18:00
       } else if (dayq == 6) {
         getWorkperiodstatus = isWorkingTime('08:00', '16:00');
       } else {
         getWorkperiodstatus = false;
       }


       if (getWorkperiodstatus) {

       
           

             if ( userphones[query.message.chat.id]== undefined) {
              QuestionPhoneTriger = false ;
               bot.sendMessage(query.message.chat.id, `–î–ª—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞–Ω–Ω—è –¥–∞–Ω–Ω–æ—é —Ñ—É–Ω–∫—Ü—ñ—î—é, –Ω–∞–¥–∞–π—Ç–µ –¥–æ–∑–≤—ñ–ª –Ω–∞ –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –í–∞—à–æ–≥–æ –Ω–æ–º–µ—Ä–∞ —Ç–µ–ª–µ—Ñ–æ–Ω—É, —á–µ—Ä–µ–∑ –∫–Ω–æ–ø–∫—É –∫–ª–∞–≤—ñ–∞—Ç—É—Ä–∏ [–ù–∞–¥—ñ—Å–ª–∞—Ç–∏ –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω—É] —ñ –ø–æ—Ç—ñ–º –ø–æ–≤—Ç–æ—Ä–Ω–æ –∑–∞–ø—É—Å—Ç–∏—Ç–∏ –∑ –≥–æ–ª–æ–≤–Ω–æ–≥–æ –º–µ–Ω—é –ø—É–Ω–∫—Ç 10. `, {
                 reply_markup: {
                   keyboard: [
                     [{
                       text: '–ù–∞–¥—ñ—Å–ª–∞—Ç–∏ –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω—É',
                       request_contact: true,




                       // –í–º–∏–∫–∞—î–º–æ –∑–∞–ø–∏—Ç –Ω–∞ –Ω–∞–¥—Å–∏–ª–∞–Ω–Ω—è –∫–æ–Ω—Ç–∞–∫—Ç—É
                     }]


                   ],

                   resize_keyboard: false

                   // –í–º–∏–∫–∞—î–º–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –∑–º–µ–Ω—à–µ–Ω–Ω—è –∫–ª–∞–≤—ñ–∞—Ç—É—Ä–∏
                 }
               });






             } else {

              bot.sendMessage(query.message.chat.id, `–í—ñ—Ç–∞—é –í–∞—Å, –ø–æ—Å—Ç–∞–≤—Ç–µ –Ω–∞–º –∑–∞–ø–∏—Ç–∞–Ω–Ω—è –∞–±–æ –æ–∑–≤—É—á—Ç–µ –ø—Ä–æ–±–ª–µ–º—É –∑ —è–∫–æ—é –í–∏ –∑—ñ—Ç–∫–Ω—É–ª–∏—Å—å –≤ –Ω–∞—à—ñ–π –ª–∞–±–æ—Ä–∞—Ç–æ—Ä—ñ—ó. –Ü –º–∏ –≤ –Ω–∞–π–∫–æ—Ä–æ—Ç—à–∏–π —á–∞—Å –∑–≤—è–∂–µ–º–æ—Å—è –∑ –í–∞–º–∏`, {
                reply_markup: {
                  force_reply: true
                }
              }).then(sent=>{
               bot.onReplyToMessage(query.message.chat.id, sent.message_id, (reply) => {
                                 if (reply.text == '/start' || reply.text == undefined || reply.text.length ==0){bot.sendMessage(query.message.chat.id,'–í–≤–µ–¥–µ–Ω–æ –Ω–µ–∫–æ—Ä–µ–∫—Ç–Ω–∏–π —Ç–µ–∫—Å—Ç');}else{
                 bot.sendMessage(query.message.chat.id, `–í–∞—à–µ –∑–∞–ø–∏—Ç–∞–Ω–Ω—è –≤—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–æ –æ–ø–µ—Ä–∞—Ç–æ—Ä—É. –û—á—ñ–∫—É–π—Ç–µ –≤—ñ–¥–ø–æ–≤—ñ–¥—å.`);
                 //  bot.sendMessage(chatId,namer).then((sent)=>{ bot.forwardMessage(-813260675, chatId, sent.message_id); } );

                 bot.sendMessage(-954144335, `–ù–∞–¥—ñ–π—à–ª–æ –∑–∞–ø–∏—Ç–∞–Ω–Ω—è –≤—ñ–¥ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –¢–µ–ª–µ–≥—Ä–∞–º-–±–æ—Ç–∞ ${sent.chat.first_name}\n     \n–¢–µ–∫—Å—Ç –∑–∞–ø–∏—Ç–∞–Ω–Ω—è:\n ${reply.text}\n –ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω—É: ${userphones[query.message.chat.id]}    \n<b>–ù–∞–≥–∞–¥—É—é –ø—Ä–æ –Ω–µ–æ–±—Ö—ñ–¥–Ω—ñ—Å—Ç—å —Ç–µ—Ä–º—ñ–Ω–æ–≤–æ –ø–µ—Ä–µ–¥–∑–≤–æ–Ω–∏—Ç–∏ –∫–ª—ñ–µ–Ω—Ç—É –¥–ª—è –æ–ø—Ä–∞—Ü—é–≤–∞–Ω–Ω—è –∑–≤–µ—Ä–Ω–µ–Ω–Ω—è.</b> `, {
                   parse_mode: 'HTML'
                 }).then(QuestionPhoneTriger = false);
               }});});
             }
          

       } else {
         bot.sendMessage(query.message.chat.id, 'üò™ –ú–∏, –Ω–∞—Ä–∞–∑—ñ –∑–∞—á–∏–Ω–µ–Ω—ñ. –ó–≤–µ—Ä–Ω–µ–Ω–Ω—è –æ–±—Ä–æ–±–ª—è—é—Ç—å—Å—è –ª–∏—à–µ –≤ —Ä–æ–±–æ—á–∏–π —á–∞—Å.');
       }


       break;













     default:
       break;
   }
 });